{% macro csrf() -%}
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
{%- endmacro %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Know-Thyself{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  {% block head %}{% endblock %}

  <!-- ================= THEME STYLES ================= -->
  <style>
    :root {
      --bg-main: #f8fafc;
      --bg-card: #ffffff;
      --text-main: #0f172a;
      --text-muted: #475569;

      --header-bg: linear-gradient(90deg, #eef2ff, #f8fafc);
      --sidebar-bg: linear-gradient(180deg, #1e3a8a, #2c3e73);

      --card-shadow: 0 10px 24px rgba(0,0,0,.08);
    }

    /* ðŸŒ™ DARK MODE */
    [data-theme="dark"] {
      --bg-main: #020617;
      --bg-card: #020617;
      --text-main: #e5e7eb;
      --text-muted: #94a3b8;

      --header-bg: linear-gradient(90deg, #020617, #020617);
      --sidebar-bg: linear-gradient(180deg, #020617, #020617);

      --card-shadow: 0 10px 30px rgba(0,0,0,.6);
    }

    body {
      margin: 0;
      background: var(--bg-main);
      color: var(--text-main);
      font-family: "Segoe UI", system-ui, sans-serif;
      transition: background .3s ease, color .3s ease;
    }

    .card {
      background: var(--bg-card);
      box-shadow: var(--card-shadow);
      color: var(--text-main);
      transition: background .3s ease, color .3s ease;
    }

    .text-muted {
      color: var(--text-muted) !important;
    }

    /* ================= SIDEBAR ================= */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 260px;
      height: 100vh;
      background: var(--sidebar-bg);
      color: #e5e7eb;
      padding: 22px 18px;
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }

    .brand {
      text-align: center;
      margin-bottom: 26px;
    }

    .brand img {
      height: 78px;
      margin-bottom: 10px;
    }

    .brand h4 {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 0;
    }

    .sidebar h6 {
      font-size: .72rem;
      letter-spacing: .14em;
      color: #c7d2fe;
      margin: 22px 0 8px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      color: #e5e7eb;
      text-decoration: none;
      font-size: .95rem;
      margin-bottom: 4px;
      transition: background .2s ease, padding-left .2s ease;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: rgba(255,255,255,.18);
      font-weight: 600;
      padding-left: 16px;
    }

    .sidebar .logout {
      margin-top: auto;
    }

    /* ================= HEADER ================= */
    .top-header {
      margin-left: 260px;
      height: 58px;
      background: var(--header-bg);
      display: flex;
      align-items: center;
      padding: 0 28px;
      box-shadow: 0 1px 6px rgba(0,0,0,.06);
    }

    .role-badge {
      margin-left: auto;
      background: #e0e7ff;
      color: #1e3a8a;
      font-size: .72rem;
      font-weight: 700;
      padding: 6px 14px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    /* ================= MAIN ================= */
    .main-content {
      margin-left: 260px;
      padding: 32px;
      min-height: calc(100vh - 58px);
    }

    /* ================= FOOTER ================= */
    footer {
      margin-left: 260px;
      background: #020617;
      color: #94a3b8;
      padding: 14px 32px;
      font-size: .82rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* ================= QUICK TIPS ================= */
.quick-tips-card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 14px;
  padding: 18px 22px;
  color: var(--text-main);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 25px rgba(59, 130, 246, 0.12);
}

[data-theme="light"] .quick-tips-card {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 24px rgba(0,0,0,.08);
}

.quick-tips-card h6 {
  font-weight: 700;
}

.quick-tips-card ul {
  padding-left: 18px;
  font-size: .92rem;
}
#themeToggle {
  background: transparent;
  color: var(--text-main);
  border-color: rgba(100, 116, 139, 0.4);
}

#themeToggle:hover {
  background: rgba(100, 116, 139, 0.15);
}

  </style>
</head>

<body>

<!-- ================= SIDEBAR ================= -->
<aside class="sidebar">
  <div class="brand">
    <img src="https://res.cloudinary.com/ddqeqxamf/image/upload/v1754506544/psychology_logo_dqa0hs.jpg">
    <h4>Know-Thyself</h4>
  </div>

  {% if current_user.is_authenticated and current_user.role == "teacher" %}
    <h6>TEACHER</h6>
    <a href="{{ url_for('teacher_dashboard') }}" data-path="/teacher/dashboard"><i class="bi bi-house"></i>Dashboard</a>
    <a href="{{ url_for('add_job') }}"><i class="bi bi-plus-circle"></i>Create Job</a>
    <a href="{{ url_for('manage_jobs') }}"><i class="bi bi-briefcase"></i>Manage Jobs</a>
    <a href="{{ url_for('registered_students') }}"><i class="bi bi-people"></i>Registered Students</a>
    <a href="{{ url_for('teacher_self_assessments') }}"><i class="bi bi-clipboard-heart"></i>Self Assessments</a>
    <a href="{{ url_for('teacher_growth_hub') }}"><i class="bi bi-flower1"></i>Growth Hub</a>
    <a href="{{ url_for('export_dashboard_data') }}"><i class="bi bi-download"></i>Export Data</a>
    <a href="{{ url_for('clear_applications') }}" class="text-danger"><i class="bi bi-trash"></i>Clear Applications</a>
  {% else %}
    <h6>STUDENT</h6>
    <a href="{{ url_for('student_dashboard') }}"><i class="bi bi-house"></i>Dashboard</a>
    <a href="{{ url_for('student_jobs') }}"><i class="bi bi-briefcase"></i>Jobs</a>
    <a href="{{ url_for('student_applications') }}"><i class="bi bi-file-earmark-text"></i>Applications</a>

    <h6>GROWTH</h6>
    <a href="{{ url_for('student_self_assessment_intro') }}"><i class="bi bi-clipboard-heart"></i>Self Assessment</a>
    <a href="{{ url_for('growth_hub_menu') }}"><i class="bi bi-flower1"></i>Growth Hub</a>

    <h6>EXPLORE</h6>
    <a href="{{ url_for('resources') }}"><i class="bi bi-journal"></i>Resources</a>
    <a href="{{ url_for('support') }}"><i class="bi bi-question-circle"></i>Support</a>
    <a href="{{ url_for('about') }}"><i class="bi bi-info-circle"></i>About</a>
  {% endif %}

  <div class="logout">
    <a href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i>Logout</a>
  </div>
</aside>

<!-- ================= HEADER ================= -->
<header class="top-header">
  {% if current_user.is_authenticated %}
    <span class="fw-semibold text-muted">
      Welcome, {{ current_user.name }}
    </span>

    <button id="themeToggle"
            class="btn btn-sm ms-3 me-3 rounded-pill border"
            title="Toggle theme">
      <i class="bi bi-moon-stars"></i>
    </button>

    <span class="role-badge">
      {{ current_user.role|upper }}
    </span>
  {% endif %}
</header>
<!-- ================= MAIN ================= -->
<main class="main-content">
  {% block content %}{% endblock %}
</main>

<!-- ================= FOOTER ================= -->
<footer>
  <span>Know-Thyself Â· Psychology Career Portal</span>
  <span>Built with Flask Â· MongoDB Â· Bootstrap</span>
</footer>

<!-- ================= SCRIPTS ================= -->
<script>
  const root = document.documentElement;
  const toggleBtn = document.getElementById("themeToggle");
  const icon = toggleBtn.querySelector("i");

  const USER_THEME_KEY = "userTheme";      // manual override
  const AUTO_THEME_KEY = "autoTheme";      // auto applied once

  function applyTheme(theme) {
    root.setAttribute("data-theme", theme);
    icon.className =
      theme === "dark"
        ? "bi bi-sun-fill"
        : "bi bi-moon-stars";
  }

  // -----------------------------
  // AUTO MODE (6 PM â†’ 6 AM)
  // -----------------------------
  function autoThemeIfAllowed() {
    const savedUserTheme = localStorage.getItem(USER_THEME_KEY);
    if (savedUserTheme) {
      applyTheme(savedUserTheme);
      return;
    }

    const hour = new Date().getHours();

    if (hour >= 18 || hour < 6) {
      applyTheme("dark");
    } else {
      applyTheme("light");
    }
  }

  // Initial apply
  autoThemeIfAllowed();

  // -----------------------------
  // MANUAL TOGGLE (OVERRIDES AUTO)
  // -----------------------------
  toggleBtn.addEventListener("click", () => {
    const current = root.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";

    applyTheme(next);
    localStorage.setItem(USER_THEME_KEY, next);
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% block scripts %}{% endblock %}
</body>
</html>